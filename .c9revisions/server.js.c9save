{"ts":1361715806658,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"#!/bin/env node\n//  OpenShift sample Node application\nvar express = require('express');\nvar fs      = require('fs');\n\n\n/**\n *  Define the sample application.\n */\nvar SampleApp = function() {\n\n    //  Scope.\n    var self = this;\n\n\n    /*  ================================================================  */\n    /*  Helper functions.                                                 */\n    /*  ================================================================  */\n\n    /**\n     *  Set up server IP address and port # using env variables/defaults.\n     */\n    self.setupVariables = function() {\n        //  Set the environment variables we need.\n        self.ipaddress = process.env.OPENSHIFT_INTERNAL_IP;\n        self.port      = process.env.OPENSHIFT_INTERNAL_PORT || 8080;\n\n        if (typeof self.ipaddress === \"undefined\") {\n            //  Log errors on OpenShift but continue w/ 127.0.0.1 - this\n            //  allows us to run/test the app locally.\n            console.warn('No OPENSHIFT_INTERNAL_IP var, using 127.0.0.1');\n            self.ipaddress = \"127.0.0.1\";\n        };\n    };\n\n\n    /**\n     *  Populate the cache.\n     */\n    self.populateCache = function() {\n        if (typeof self.zcache === \"undefined\") {\n            self.zcache = { 'index.html': '' };\n        }\n\n        //  Local cache for static content.\n        self.zcache['index.html'] = fs.readFileSync('./index.html');\n    };\n\n\n    /**\n     *  Retrieve entry (content) from cache.\n     *  @param {string} key  Key identifying content to retrieve from cache.\n     */\n    self.cache_get = function(key) { return self.zcache[key]; };\n\n\n    /**\n     *  terminator === the termination handler\n     *  Terminate server on receipt of the specified signal.\n     *  @param {string} sig  Signal to terminate on.\n     */\n    self.terminator = function(sig){\n        if (typeof sig === \"string\") {\n           console.log('%s: Received %s - terminating sample app ...',\n                       Date(Date.now()), sig);\n           process.exit(1);\n        }\n        console.log('%s: Node server stopped.', Date(Date.now()) );\n    };\n\n\n    /**\n     *  Setup termination handlers (for exit and a list of signals).\n     */\n    self.setupTerminationHandlers = function(){\n        //  Process on exit and signals.\n        process.on('exit', function() { self.terminator(); });\n\n        // Removed 'SIGPIPE' from the list - bugz 852598.\n        ['SIGHUP', 'SIGINT', 'SIGQUIT', 'SIGILL', 'SIGTRAP', 'SIGABRT',\n         'SIGBUS', 'SIGFPE', 'SIGUSR1', 'SIGSEGV', 'SIGUSR2', 'SIGTERM'\n        ].forEach(function(element, index, array) {\n            process.on(element, function() { self.terminator(element); });\n        });\n    };\n\n\n    /*  ================================================================  */\n    /*  App server functions (main app logic here).                       */\n    /*  ================================================================  */\n\n    /**\n     *  Create the routing table entries + handlers for the application.\n     */\n    self.createRoutes = function() {\n        self.routes = { };\n\n        // Routes for /health, /asciimo and /\n        self.routes['/health'] = function(req, res) {\n            res.send('1');\n        };\n\n        self.routes['/asciimo'] = function(req, res) {\n            var link = \"http://i.imgur.com/kmbjB.png\";\n            res.send(\"<html><body><img src='\" + link + \"'></body></html>\");\n        };\n\n        self.routes['/'] = function(req, res) {\n            res.setHeader('Content-Type', 'text/html');\n            res.send(self.cache_get('index.html') );\n        };\n    };\n\n\n    /**\n     *  Initialize the server (express) and create the routes and register\n     *  the handlers.\n     */\n    self.initializeServer = function() {\n        self.createRoutes();\n        self.app = express.createServer();\n\n        //  Add handlers for the app (from the routes).\n        for (var r in self.routes) {\n            self.app.get(r, self.routes[r]);\n        }\n    };\n\n\n    /**\n     *  Initializes the sample application.\n     */\n    self.initialize = function() {\n        self.setupVariables();\n        self.populateCache();\n        self.setupTerminationHandlers();\n\n        // Create the express server and routes.\n        self.initializeServer();\n    };\n\n\n    /**\n     *  Start the server (starts up the sample application).\n     */\n    self.start = function() {\n        //  Start the app on the specific interface (and port).\n        self.app.listen(self.port, self.ipaddress, function() {\n            console.log('%s: Node server started on %s:%d ...',\n                        Date(Date.now() ), self.ipaddress, self.port);\n        });\n    };\n\n};   /*  Sample Application.  */\n\n\n\n/**\n *  main():  Main code.\n */\nvar zapp = new SampleApp();\nzapp.initialize();\nzapp.start();\n\n"]],"start1":0,"start2":0,"length1":0,"length2":4776}]],"length":4776}
{"contributors":[],"silentsave":false,"ts":1361717122637,"patch":[[{"diffs":[[0,"ress"],[-1,".createServer"],[0,"();\n"]],"start1":3788,"start2":3788,"length1":21,"length2":8}]],"length":4763,"saved":false}
{"ts":1361717312769,"patch":[[{"diffs":[[0,"dex.html');\n"],[1,"        self.zcache['form.html'] = fs.readFileSync('./form.html');\n"],[0,"    };\n\n\n   "]],"start1":1383,"start2":1383,"length1":24,"length2":91},{"diffs":[[0,"l>\");\n        };"],[1,"\n        \n        self.routes['/form'] = function(req, res) {\n            res.setHeader('Content-Type', 'text/html');\n            res.send(self.cache_get('form.html') );\n        };"],[0,"\n\n        self.r"]],"start1":3455,"start2":3455,"length1":32,"length2":212}]],"length":5010,"saved":false}
